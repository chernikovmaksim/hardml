# Схема процесса
[final.drawio](final.drawio)

# Автор
https://t.me/chernikovmaksim

# Контрольные вопросы

1. Каким образом файлы с индексами попадают на целевые машины? Попадают ли индексы адресно или происходит broadcast одного файла на все сервера?
Ответ: индексы попадают адресно, каждый индекс на свою целевую машину

2. Написали ли ли вы стратегию обновления индекса в системе? Что это за стратегия: Blue/Green или Rolling? А есть ли у вашей стратегии downtime?
Ответ: cтратегия обновления больше похожа на canary deployment. Downtime у нас будет 0. Мы плавно перенаправялем потоки трафика на новое приложение.

3. При обновлении индекса обновляются ли необходимые параметры в других частях системы? Т.е. не случится ли такого, что gateway направляет запрос не на тот индекс, если во время обновления что-то пошло не так? Не забыли ли вы про идемпотентность обновлений в вашей стратегии?
Ответ: не случится, так как центроиды в gateway обновляются вместе с индексами в partition на одну и ту же версию. Это позволит избежать коллизий.

4. Что будет, если индекс не сможет обновиться? (например, попался битый файл индекса)
Ответ: процесс еще несколько раз попробует перелить данные. Если все равно не удастся, то мы создадим лог файл и остановим процесс обнолвения системы.

5. Может быть, вы не поленились и предусмотрели какие-нибудь failover?
Ответ: храним бэкапы S3 и ищем версию индекса там, в случае ошибок при копировании.

6. Вы использовали уже готовые инструменты, знакомые многим, или решили написали свой shellсипед?
Ответ: использоть можно готовые инструменты: docker, nginx, flask, gitlab ci, elastic, kibana, logstash и т.д.

7. А что с самими приложениями сервинга? Не перегружен ли его запуск внешними зависимостями, правильно ли выключается и поднимается приложение. Существует способ быстро проверить здорово ли приложение?
Ответ: запуск не перегружен зависимостями, проверить можно либо через healthcheck, либо через тестовый запрос.


